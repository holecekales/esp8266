<!DOCTYPE html>
<html>
<title>File Upload</title>

<head>
    <style>
        ::-webkit-scrollbar {
            -webkit-appearance: none;
            width: 12px;
        }

        ::-webkit-scrollbar-thumb {
            border-radius: 4px;
            background-color: rgba(46, 45, 45, 0.493);
            box-shadow: 0 0 1px rgba(255, 255, 255, .5);
        }

        body {
            margin: 0px;
            height: 100%;
            font-family: 'Segoe UI', 'Tahoma', 'Geneva', 'Verdana', sans-serif;
        }

        .box {
            background-color: #444;
            color: #fff;
            width: 100%;
            height: 100%;
        }

        .header {
            padding-left: 20px;
            grid-area: header;
            background-color: rgb(1, 64, 83);
            font-size: 200%;
            display: flex;
            align-items: center;
        }

        .tools {
            grid-area: tools;
            position: relative;
        }

        .sidebar {
            grid-area: sidebar;
            position: absolute;
        }

        .content {
            grid-area: content;
        }

        .fooder {
            grid-area: fooder;
            padding-left: 20px;
        }

        .wrapper {
            display: grid;
            grid-template-columns: 150px auto;
            grid-template-rows: 50px max-content auto 30px;
            grid-template-areas: "header header" "tools content" "sidebar content" "fooder fooder";
            grid-gap: 2px;
            background-color: #777;
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
        }

        #editor {
            position: relative;
            height: 100%;
            width: 100%;
            overflow: hidden;
            display: block;
        }

        #fileListContainer {
            width: 100%;
            height: 100%;
            /* float: left; add this */
            display: block;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            background-color: rgb(143, 142, 142)
        }

        /* Overwrite the default to keep the scrollbar always visible */

        input[type="file"] {
            display: none;
        }

        .custom-file-upload {
            /* border: 1px solid black; */
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
        }

        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            width: 200px;
            height: 100%
        }

        li a {
            display: block;
            color: #000;
            padding: 8px 16px;
            text-decoration: none;
        }

        /* Change the link color on hover */

        li a:hover {
            background-color: #555;
            color: white;
        }

        .ace_scrollbar-inner {
            background-color: white;
            opacity: 0.5;
        }
    </style>

    <script>
        function getFileList(fl) {
            var productList = JSON.parse(fl);
            var ul = document.querySelector('#fileList');
            while (ul.firstChild) {
                ul.removeChild(ul.firstChild);
            }
            productList.forEach((elemName) => {
                for (var i = 0; i < 4; i++) {
                    var li = document.createElement('li');
                    var a = document.createElement("a");
                    a.setAttribute('href', elemName.url);
                    a.innerHTML = elemName.name;
                    li.appendChild(a);
                    ul.appendChild(li);
                }
            });
        }

        function load(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = () => {
                if (xhr.readyState === 4) {
                    var debug = document.querySelector("#dump");
                    if (xhr.status == 200)
                        debug.innerHTML = "OK";
                    else
                        debug.innerHTML = "Error " + xhr.status + " for " + xhr.responseURL + "<br \/>";

                    callback(xhr.response);
                }
            }
            xhr.open('GET', url, true);
            xhr.send('');
        }    
    </script>

</head>

<body>

    <div class="wrapper">
        <div class="box header">Header</div>
        
        <div class="box tools">
        
            <form enctype="multipart/form-data" method="post" name="fileUploader">
                <label class="custom-file-upload">
                    <input type="file" name="file" multiple/>Add New
                </label>
            </form>
<!--            
            <select id="mode" size="1">
                <option value="ace/mode/css">css</option>
                <option value="ace/mode/html">html</option>
                <option value="ace/mode/ini">ini</option>
                <option value="ace/mode/javascript" selected>javascript</option>
                <option value="ace/mode/json">json</option>
                <option value="ace/mode/markdown">markdown</option>
                <option value="ace/mode/svg">svg</option>
                <option value="ace/mode/text">text</option>
                <option value="ace/mode/typescript">typescript</option>
            </select>
            <button id="load">Load</button>
        -->            
        </div>

        <div class="box sidebar">
            <div id="fileListContainer">
                <ul id="fileList">
                </ul>
            </div>

        </div>

        <div class="box content">
            <div id="editor">function foo(items) { var x = "All this is syntax highlighted"; return x; }</div>
        </div>

        <div class="box fooder">
            <div id="dump"></div>
        </div>
    </div>

    <script src="//ajaxorg.github.io/ace-builds/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    <script>
        // form submission
        var form = document.forms.namedItem("fileUploader");
        form.addEventListener('change', (ev) => {
            var oOutput = document.querySelector("#dump"),
                oData = new FormData(form);

            oData.append("CustomField", "This is some extra data");

            var oReq = new XMLHttpRequest();
            oReq.open("POST", "/upload", true);
            oReq.onload = function (oEvent) {
                if (oReq.status == 200) {
                    oOutput.innerHTML = "Uploaded!";
                    load('/upload', getFileList);
                }
                else
                    oOutput.innerHTML = "Error " + oReq.status + " occurred when trying to upload your file.<br \/>";
            };
            oReq.send(oData);
            ev.preventDefault();
        }, false);

        // handling of the editor
        var editor = ace.edit("editor");
        editor.getSession().setUseWorker(false);
        editor.setTheme("ace/theme/monokai");
        // editor.setTheme("ace/theme/twilight");
        editor.getSession().setMode("ace/mode/javascript");

/*
        var elem = document.getElementById('mode');
        elem.addEventListener("change", (ev) => {
            var mode = ev.target.value;
            editor.getSession().setMode(mode);
        });

        elem = document.getElementById('load');
        elem.addEventListener('click', (ev) => {
            editor.getSession().setValue("text");
        });
*/
        elem = document.querySelector('#fileList');
        elem.addEventListener('click', (ev) => {
            var x = ev.target.nodeName;
            if (x == 'A') {
                var debug = document.querySelector("#dump");
                load(ev.target.href, cb);
                function cb(r) {
                    editor.getSession().setValue(r);
                }
            }
            ev.preventDefault();
        });

        load('/upload', getFileList);

    </script>

</body>

</html>